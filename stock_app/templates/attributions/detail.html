{% extends "base.html" %}

{% block content %}
<div class="max-w-6xl mx-auto p-6 space-y-6">

  <!-- Breadcrumb -->
  <nav class="text-sm text-gray-500 flex items-center space-x-2">
    <a href="{% url 'dashboard' %}" class="hover:underline text-[#004F9F]">Dashboard</a>
    <span>/</span>
    <a href="{% url 'liste_attributions' %}" class="hover:underline">D√©ploiements</a>
    <span>/</span>
    <span class="font-semibold text-gray-700">D√©tails #{{ attribution.id }}</span>
  </nav>

  <!-- Header -->
  <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
    <h1 class="text-3xl font-bold text-[#004F9F] flex items-center gap-2">
      üìå D√©tails du d√©ploiement #{{ attribution.id }}
    </h1>
    <a href="{% url 'liste_attributions' %}" 
       class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-xl shadow transition flex items-center gap-2">
       ‚¨Ö Retour √† la liste
    </a>
  </div>

  <!-- Informations g√©n√©rales (mini-dashboard cards) -->
  <div class="grid md:grid-cols-2 gap-6">
    
    <!-- Carte Usager -->
    <div class="bg-white p-6 rounded-2xl shadow-md hover:shadow-lg transition flex flex-col gap-3">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üë§</span>
        <h3 class="text-lg font-semibold text-gray-700">Usager</h3>
      </div>
      <p class="text-gray-600">{{ attribution.prenom }} {{ attribution.nom }}</p>
      <p class="text-gray-600"><strong>Email:</strong> {{ attribution.email }}</p>
      <p class="text-gray-600"><strong>R√©f√©rence:</strong> {{ attribution.ref }}</p>
      <p class="text-gray-600"><strong>Date:</strong> {{ attribution.date_attri|date:"d/m/Y H:i" }}</p>
    </div>

    <!-- Carte Direction / Service -->
    <div class="bg-white p-6 rounded-2xl shadow-md hover:shadow-lg transition flex flex-col gap-3">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üè¢</span>
        <h3 class="text-lg font-semibold text-gray-700">Organisation</h3>
      </div>
      <p class="text-gray-600"><strong>Direction :</strong> {{ attribution.get_direction_display }}</p>
      <p class="text-gray-600"><strong>D√©partement :</strong> {{ attribution.get_departement_display }}</p>
      <p class="text-gray-600"><strong>Service :</strong> {{ attribution.get_service_display }}</p>
      <p class="text-gray-600"><strong>Localit√© :</strong> {{ attribution.locality }}</p>
      <p class="text-gray-600"><strong>S√©rie :</strong> {{ attribution.serie }}</p>
      <p class="text-gray-600 flex items-center gap-2"><strong>√âtat :</strong> 
        <span class="px-3 py-1 rounded-full font-semibold text-white
          {% if attribution.etat == 'bon' %}bg-green-500{% elif attribution.etat == 'pass' %}bg-yellow-500{% else %}bg-red-500{% endif %}">
          {{ attribution.get_etat_display }}
        </span>
      </p>
      <p class="text-gray-600"><strong>Utilisateur :</strong> {{ attribution.utilisateur }}</p>
    </div>
  </div>

  <!-- Mat√©riels attribu√©s -->
  <div class="bg-white rounded-2xl shadow-md overflow-x-auto">
    <h2 class="text-xl font-semibold text-[#004F9F] px-6 py-4 border-b border-gray-200 flex items-center gap-2">
      üíº √âquipements d√©ploy√©s
    </h2>
    <table class="min-w-full divide-y divide-gray-200 text-gray-700">
      <thead class="bg-[#004F9F] text-white">
        <tr>
          <th class="p-3 text-left">Mat√©riel</th>
          <th class="p-3 text-left">Cat√©gorie</th>
          <th class="p-3 text-left">Fabricant</th>
          <th class="p-3 text-left">Description</th>
          <th class="p-3 text-left">Mod√®le</th>
          <th class="p-3 text-center">Quantit√©</th>
          <th class="p-3 text-center">Stock</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for item in attribution.attribumateriel_set.all %}
          <tr class="hover:bg-gray-50 transition cursor-pointer">
            <td class="p-3 font-medium">{{ item.materiel }}</td>
            <td class="p-3">{{ item.materiel.categorie }}</td>
            <td class="p-3">{{ item.materiel.fabricant }}</td>
            <td class="p-3">{{ item.materiel.description }}</td>
            <td class="p-3">{{ item.materiel.modal }}</td>
            <td class="p-3 text-center font-semibold">{{ item.quantite }}</td>
            <td class="p-3 text-center font-semibold">
              {% with stock=item.materiel.stock_set.first %}
                {{ stock.quantite|default:"0" }}
              {% endwith %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="7" class="p-4 text-gray-500 italic text-center">
              Aucun mat√©riel attribu√©
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
