{% extends "attributions/base.html" %}

{% block content %}
<div class="max-w-5xl mx-auto p-6">

  <!-- Header -->
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-3xl font-bold text-[#004F9F]">ðŸ“Œ DÃ©tails du deploiement #{{ attribution.id }}</h1>
    <a href="{% url 'liste_attributions' %}" 
       class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-xl shadow transition">
       â¬… Retour Ã  la liste
    </a>
  </div>

  <!-- Informations gÃ©nÃ©rales -->
  <div class="grid md:grid-cols-2 gap-6 mb-6">
    <div class="bg-white p-4 rounded-lg shadow hover:shadow-md transition">
      <p class="text-gray-600"><strong>ðŸ“… Date deploiement :</strong> <span class="text-gray-900">{{ attribution.date_attri|date:"d/m/Y H:i" }}</span></p>
      <p class="text-gray-600"><strong>RÃ©fÃ©rence :</strong> <span class="text-gray-900">{{ attribution.ref }}</span></p>
      <p class="text-gray-600"><strong>ðŸ‘¤ Usager :</strong> <span class="text-gray-900">{{ attribution.prenom }} {{ attribution.nom }}</span></p>
      <p class="text-gray-600"><strong>Email :</strong> <span class="text-gray-900">{{ attribution.email }}</span></p>
    </div>
    <div class="bg-white p-4 rounded-lg shadow hover:shadow-md transition">
      <p class="text-gray-600"><strong>Direction :</strong> <span class="text-gray-900">{{ attribution.get_direction_display }}</span></p>
      <p class="text-gray-600"><strong>DÃ©partement :</strong> <span class="text-gray-900">{{ attribution.get_departement_display }}</span></p>
      <p class="text-gray-600"><strong>Service :</strong> <span class="text-gray-900">{{ attribution.get_service_display }}</span></p>
      <p class="text-gray-600"><strong>LocalitÃ© :</strong> <span class="text-gray-900">{{ attribution.locality }}</span></p>
      <p class="text-gray-600"><strong>SÃ©rie :</strong> <span class="text-gray-900">{{ attribution.serie }}</span></p>
      <p class="text-gray-600"><strong>Ã‰tat :</strong> 
        <span class="px-2 py-1 rounded-full text-white font-semibold 
          {% if attribution.etat == 'bon' %} bg-green-500 
          {% elif attribution.etat == 'pass' %} bg-yellow-500 
          {% else %} bg-red-500 {% endif %}">
          {{ attribution.get_etat_display }}
        </span>
      </p>
      <p class="text-gray-600"><strong>Utilisateur :</strong> <span class="text-gray-900">{{ attribution.utilisateur }}</span></p>
    </div>
  </div>

  <!-- MatÃ©riels attribuÃ©s -->
  <div class="bg-white rounded-lg shadow overflow-x-auto">
    <h2 class="text-xl font-semibold text-[#004F9F] px-4 py-3 border-b border-gray-200">ðŸ’¼ Equipement dÃ©ploiyÃ©</h2>
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-[#004F9F] text-white">
        <tr>
          <th class="p-3 text-left">MatÃ©riel</th>
          <th class="p-3 text-left">CatÃ©gorie</th>
          <th class="p-3 text-left">Fabricant</th>
          <th class="p-3 text-left">Description</th>
          <th class="p-3 text-left">ModÃ¨le</th>
          <th class="p-3 text-center">QuantitÃ© deploiyer</th>
          <th class="p-3 text-center">Stock actuel</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for item in attribution.attribumateriel_set.all %}
          <tr class="hover:bg-gray-50 transition cursor-pointer">
            <td class="p-3">{{ item.materiel }}</td>
            <td class="p-3">{{ item.materiel.categorie }}</td>
            <td class="p-3">{{ item.materiel.fabricant }}</td>
            <td class="p-3">{{ item.materiel.description }}</td>
            <td class="p-3">{{ item.materiel.modal }}</td>
            <td class="p-3 text-center font-semibold">{{ item.quantite }}</td>
            <td class="p-3 text-center font-semibold">
              {% with stock=item.materiel.stock_set.first %}
                {{ stock.quantite|default:"0" }}
              {% endwith %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="7" class="p-4 text-gray-500 italic text-center">
              Aucun matÃ©riel attribuÃ©
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
