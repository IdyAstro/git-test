{% extends "base.html" %}

{% block content %}
<div class="p-6 max-w-7xl mx-auto space-y-6">

  <!-- En-t√™te -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <h1 class="text-3xl font-bold text-[#005BAC] flex items-center gap-2">
      üõí HISTORIQUE DES SORTIES
    </h1>
    <a href="{% url 'nouvel_approvisionnement' %}" 
       class="bg-gradient-to-r from-[#005BAC] to-[#004080] text-white px-5 py-2 rounded-xl shadow hover:scale-105 transition flex items-center gap-2">
       ‚ûï NOUVELLE SORTIE
    </a>
  </div>

  <!-- Barre de recherche et filtres -->
  <div class="bg-white rounded-xl shadow p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <form method="get" class="flex items-center gap-2 w-full md:w-auto">
      <input type="text" name="q" placeholder="üîç Rechercher (utilisateur ou mat√©riel)" 
             value="{{ request.GET.q }}" 
             class="border rounded-lg p-2 w-full md:w-80 focus:outline-none focus:ring-2 focus:ring-[#005BAC] text-sm"
             aria-label="Rechercher un approvisionnement">
      <button type="submit" 
              class="bg-[#F26F21] text-white px-4 py-2 rounded-lg shadow hover:bg-[#c7530d] transition">
        Rechercher
      </button>
      {% if request.GET.q %}
        <a href="{% url 'liste_appros' %}" class="text-sm text-[#005BAC] underline">‚ùå R√©initialiser</a>
      {% endif %}
    </form>
  </div>

  <!-- Messages -->
  {% if messages %}
    <div class="space-y-2">
      {% for message in messages %}
        <div class="px-4 py-2 rounded-lg text-sm font-medium shadow-md
          {% if message.tags == 'success' %}
            bg-green-50 text-green-700 border border-green-300
          {% elif message.tags == 'error' %}
            bg-red-50 text-red-700 border border-red-300
          {% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
    <!-- Pagination dans le header -->
            <div class="flex justify-end items-center gap-2">
              {% if appros.has_previous %}
                <a href="?page={{ appros.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
                   class="p-2 bg-white border rounded-lg shadow hover:bg-gray-100 transition"
                   title="Page pr√©c√©dente">
                  ‚¨Ö
                </a>
              {% else %}
                <span class="p-2 bg-gray-200 text-gray-400 border rounded-lg cursor-not-allowed">‚¨Ö</span>
              {% endif %}

              <span class="text-xs font-semibold">
                {{ appros.number }}/{{ appros.paginator.num_pages }}
              </span>

              {% if appros.has_next %}
                <a href="?page={{ appros.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
                   class="p-2 bg-white border rounded-lg shadow hover:bg-gray-100 transition"
                   title="Page suivante">
                  ‚û°
                </a>
              {% else %}
                <span class="p-2 bg-gray-200 text-gray-400 border rounded-lg cursor-not-allowed">‚û°</span>
              {% endif %}
            </div>
  <!-- Tableau des approvisionnements -->
  <div class="overflow-x-auto bg-white rounded-xl shadow">
    <table class="w-full text-left text-sm">
      <thead class="bg-[#005BAC] text-white">
        <tr>
          <th class="px-4 py-3">üìÖ Date</th>
          <th class="px-4 py-3">üë§ Utilisateur</th>
          <th class="px-4 py-3">üì¶ Equipements</th>
      
        </tr>
      </thead>
      <tbody class="divide-y">
        {% for appro in appros %}
        <tr class="hover:bg-gray-50 transition">
          <td class="px-4 py-3 font-medium text-[#005BAC]">
            {{ appro.date_appro|date:"d/m/Y H:i" }}
          </td>
          <td class="px-4 py-3 text-gray-700">
            {{ appro.utilisateur.nom }}
          </td>
          <td class="px-4 py-3">
            <ul class="space-y-1">
              {% for ligne in appro.appromateriel_set.all %}
                <li class="flex items-center justify-between">
                  <span>{{ ligne.materiel }}</span>
                  <span class="px-2 py-0.5 rounded-full text-xs text-white
                               {% if ligne.quantite > 10 %} bg-green-500 {% else %} bg-orange-500 {% endif %}">
                    {{ ligne.quantite }}
                  </span>
                </li>
              {% endfor %}
            </ul>
          </td>
           <!--   <td class="px-4 py-3 text-center space-x-3">
            <a href="{% url 'detail_appro' appro.id %}" class="text-blue-600 hover:underline">üîé</a>
            <a href="{% url 'modifier_appro' appro.id %}" class="text-green-600 hover:underline">‚úèÔ∏è</a>
          </td> -->
        
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="px-4 py-6 text-center text-gray-500 italic">
            Aucunne reception trouv√©e.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
