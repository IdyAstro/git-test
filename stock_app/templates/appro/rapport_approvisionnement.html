{% extends "appro/base.html" %}
{% block content %}
<div class="p-6">
  <h1 class="text-xl font-bold mb-4">üì¶ RAPPORT DEPLOIEMENT & RECUPERATION</h1>

  <a href="?export=excel" class="px-4 py-2 bg-green-600 text-white rounded">Exporter Excel</a>

  <!-- Approvisionnements -->
  <h2 class="text-lg font-semibold mt-6">RECUPERATION</h2>
  <table class="table-auto w-full border">
    <thead class="bg-gray-200">
      <tr>
        <th class="px-2 py-1 border">Date</th>
        <th class="px-2 py-1 border">Utilisateur</th>
        <th class="px-2 py-1 border">Mat√©riel</th>
        <th class="px-2 py-1 border">Quantit√©</th>
      </tr>
    </thead>
    <tbody>
      {% for appro in approvisionnements %}
        {% for ligne in appro.appromateriel_set.all %}
        <tr class="border">
          <td class="px-2 py-1">{{ appro.date_appro|date:"Y-m-d" }}</td>
          <td class="px-2 py-1">{{ appro.utilisateur.nom }}</td>
          <td class="px-2 py-1">{{ ligne.materiel }}</td>
          <td class="px-2 py-1">{{ ligne.quantite }}</td>
        </tr>
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>

  <!-- Attributions -->
  <h2 class="text-lg font-semibold mt-6">DEPLOIEMENT</h2>
  <table class="table-auto w-full border">
    <thead class="bg-gray-200">
      <tr>
        <th class="px-2 py-1 border">Date Deploiement</th>
     
        <th class="px-2 py-1 border">Direction</th>
        <th class="px-2 py-1 border">Utilisateur</th>
        <th class="px-2 py-1 border">Technicien</th>
        <th class="px-2 py-1 border">Mat√©riel</th>
        <th class="px-2 py-1 border">Quantit√©</th>
        <th class="px-2 py-1 border">√âtat</th>
      </tr>
    </thead>
    <tbody>
     
      {% for attri in attributions %}
        {% for ligne in attri.attribumateriel_set.all %}
        <tr class="border">
          <td class="px-2 py-1">{{ attri.date_attri|date:"Y-m-d" }}</td>
          <td class="px-2 py-1">{{ attri.direction }}</td>
          <td class="px-2 py-1">{{ attri.prenom }} {{ attri.nom }}</td>
          <td class="px-2 py-1">{{ attri.utilisateur.nom }}</td>
          <td class="px-2 py-1">{{ ligne.materiel }}</td>
          <td class="px-2 py-1">{{ ligne.quantite }}</td>
          <td class="px-2 py-1">{{ attri.get_etat_display }}</td>
        </tr>
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
