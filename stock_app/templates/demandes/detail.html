{% extends "demandes/base.html" %}

{% block content %}
<div class="p-6 max-w-4xl mx-auto">

  <!-- En-tête -->
  <div class="mb-6 flex justify-between items-center">
    <h1 class="text-3xl font-bold text-[#004F9F]">📝 Détail de la demande</h1>
    <a href="{% url 'listes_exhaussive' %}" 
       class="bg-[#004F9F] hover:bg-blue-900 text-white px-4 py-2 rounded-lg shadow transition">
       ⬅ Retour à la liste
    </a>
  </div>

  <!-- Card principale -->
  <div class="bg-white shadow-lg rounded-2xl p-6 border border-gray-200">
    
    <!-- Informations principales -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Nom & Prénom</h2>
        <p class="text-lg font-bold text-[#004F9F]">{{ demande.prenom }} {{ demande.nom }}</p>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Matériel</h2>
        <p class="text-lg text-gray-800">{{ demande.materiel.categorie }} - {{ demande.materiel.description }}</p>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Quantité</h2>
        <p class="text-lg font-semibold text-[#F58220]">{{ demande.quantite }}</p>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Statut</h2>
        <span class="px-3 py-1 rounded-full 
                     {% if demande.statut == 'en_attente' %}bg-yellow-100 text-yellow-800
                     {% elif demande.statut == 'valide' %}bg-green-100 text-green-800
                     {% elif demande.statut == 'rejete' %}bg-red-100 text-red-800
                     {% endif %} font-semibold">
          {{ demande.get_statut_display }}
        </span>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Direction</h2>
        <p class="text-gray-800">{{ demande.direction }}</p>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Département</h2>
        <p class="text-gray-800">{{ demande.departement }}</p>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Service</h2>
        <p class="text-gray-800">{{ demande.service }}</p>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Centre</h2>
        <p class="text-gray-800">{{ demande.centre }}</p>
      </div>
      <div class="md:col-span-2">
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Motif</h2>
        <p class="text-gray-800">{{ demande.motif }}</p>
      </div>
      <div class="md:col-span-2">
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Email</h2>
        <p class="text-gray-800">{{ demande.email }}</p>
      </div>
      <div class="md:col-span-2">
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Date de la demande</h2>
        <p class="text-gray-800">{{ demande.date_demande|date:"d/m/Y H:i" }}</p>
      </div>
    </div>

    <!-- Actions -->
    <div class="flex space-x-4 mt-4">
      <a href="{% url 'modifier_demande' demande.pk %}" 
         class="bg-yellow-400 hover:bg-yellow-500 text-white px-4 py-2 rounded-lg shadow transition">
        ✏️ Modifier
      </a>
      <form method="POST" action="{% url 'supprimer_demande' demande.pk %}" 
            onsubmit="return confirm('Voulez-vous vraiment supprimer cette demande ?')">
        {% csrf_token %}
        <button type="submit" 
                class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow transition">
          🗑 Supprimer
        </button>
      </form>
    </div>

  </div>

  <!-- Section dernières demandes (optionnelle) -->
  {% if demandes %}
  <div class="mt-10">
    <h2 class="text-2xl font-bold text-[#004F9F] mb-4">🕓 4 dernières demandes</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
      {% for d in demandes %}
        <div class="bg-white shadow rounded-lg p-4 hover:shadow-md transition">
          <p class="font-bold text-[#004F9F]">{{ d.prenom }} {{ d.nom }}</p>
          <p class="text-sm text-gray-600">📌 {{ d.materiel.categorie }} - {{ d.materiel.description }}</p>
          <p class="text-sm">Quantité : <span class="font-semibold">{{ d.quantite }}</span></p>
          <p class="text-sm">Statut : {{ d.get_statut_display }}</p>
          <a href="{% url 'detail_demande' d.pk %}" 
             class="inline-block mt-2 text-sm text-[#F58220] hover:underline">
             ➡ Voir détail
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}
